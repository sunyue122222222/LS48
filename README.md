# 数字秒表/计时器系统 (基于LS48译码器)

这是一个基于Verilog的数字秒表/计时器系统，支持正计时和倒计时功能，使用七段数码管显示时间，精度可达0.1秒。

## 项目结构

```
LS48/
├── LS48/
│   ├── LS48.v              # LS48七段数码管译码器模块及其测试台
│   ├── clk_divider.v       # 时钟分频器模块
│   ├── Timer.v             # 定时器模块
│   ├── timer_60s.v         # 60秒定时器顶层模块
│   ├── tb_clk_divider.v    # 时钟分频器测试台
│   ├── tb_Timer.v          # 定时器测试台
│   ├── tb_timer_60s.v      # 60秒定时器测试台
│   └── Makefile            # 编译和测试脚本
└── README.md               # 项目说明文档
```

## 系统功能

### 🕐 主要特性
- **双模式计时**: 正计时（秒表）和倒计时（定时器）
- **时间范围**: 00.0 ~ 59.9 秒
- **显示精度**: 0.1秒（可切换显示/隐藏小数位）
- **多种速度**: 支持1Hz、2Hz、4Hz、10Hz四种计时频率
- **按键控制**: 6个按键实现完整的操作控制
- **LED提示**: 倒计时接近结束时LED闪烁提醒
- **数码管显示**: 使用七段数码管显示时间

### 🎮 按键功能
- **KEY0**: 启动正计时模式（秒表功能）
- **KEY1**: 启动倒计时模式（定时器功能）
- **KEY2**: 切换正计时/倒计时模式
- **KEY4**: 暂停/继续计时
- **KEY5**: 切换计时频率（1Hz→2Hz→4Hz→1Hz循环）
- **KEY6**: 切换精度模式（显示/隐藏小数位）

### 📟 显示说明
- **十位数码管**: 显示秒的十位（0-5）
- **个位数码管**: 显示秒的个位（0-9）
- **小数位数码管**: 显示0.1秒位（0-9）
- **小数点**: 当启用精度模式时点亮
- **LED**: 倒计时模式下时间小于8秒时闪烁

## 模块说明

### 1. Timer.v - 核心计时器模块
- **功能**: 实现秒表和定时器的核心逻辑
- **特性**: 
  - 正计时：从00.0开始向上计时至59.9
  - 倒计时：从设定时间向下计时至00.0
  - 支持四种计时频率切换
  - 按键防抖和边沿检测
  - 暂停/继续功能
  - LED闪烁提醒功能

### 2. LS48.v - BCD到七段译码器
- **功能**: 将4位BCD码转换为七段数码管显示码
- **特性**: 
  - 支持0-9数字显示
  - 灯测试功能 (LT)
  - 消隐功能 (BI)
  - 灭零功能 (RBI/RBO)

### 3. clk_divider.v - 时钟分频器
- **功能**: 将50MHz主时钟分频为多种频率
- **输出**: 1Hz、2Hz、4Hz、10Hz时钟信号
- **特性**: 支持硬件模式和仿真模式切换

### 4. timer_60s.v - 顶层集成模块
- **功能**: 系统顶层，集成所有子模块
- **集成**: 
  - 时钟分频器
  - Timer计时逻辑
  - 两个LS48译码器（个位和小数位）
  - 完整的信号连接

## 使用方法

### 环境要求
- Icarus Verilog (iverilog)
- Make工具

### 安装依赖
```bash
# Ubuntu/Debian系统
sudo apt update
sudo apt install iverilog make

# 或者使用项目目录中的命令
apt update && apt install -y iverilog
```

### 编译和测试

1. **进入项目目录**:
```bash
cd LS48/LS48
```

2. **查看可用命令**:
```bash
make help
```

3. **语法检查**:
```bash
make syntax_check
```

4. **运行所有测试**:
```bash
make all
```

5. **单独测试各模块**:
```bash
make test_ls48        # 测试LS48模块
make test_clk_divider # 测试时钟分频器
make test_timer       # 测试定时器
make test_timer_60s   # 测试完整系统
```

6. **清理生成文件**:
```bash
make clean
```

## 测试结果

所有模块都已通过语法检查和功能测试：

- ✅ LS48七段译码器：正确实现BCD到七段码转换
- ✅ 时钟分频器：正确生成各种频率的时钟信号
- ✅ 定时器模块：正确实现计时功能
- ✅ 完整系统：各模块协同工作正常

## 使用示例

### 🕐 秒表模式（正计时）
1. 按下KEY0启动秒表
2. 时间从00.0开始向上计时
3. 按KEY4可暂停/继续
4. 按KEY5切换计时速度
5. 按KEY6切换是否显示小数位

### ⏰ 定时器模式（倒计时）
1. 设置初始时间（通过ten和one输入）
2. 按下KEY1启动倒计时
3. 时间向下计时至00.0
4. 当剩余时间<8秒时LED开始闪烁
5. 按KEY4可暂停/继续

## 修复的问题

1. **添加了缺失的LS48模块实现** - 原项目只有测试台，缺少实际的译码器模块
2. **修复了Timer模块中的语法错误** - 将阻塞赋值改为非阻塞赋值，确保时序正确
3. **修正了测试台中的端口连接问题** - 统一了信号命名和端口映射
4. **添加了完整的编译和测试环境** - Makefile和仿真脚本
5. **修复了时钟信号定义问题** - 确保时钟选择逻辑正确工作

## 开发说明

- 所有模块都支持仿真模式，便于快速验证功能
- 使用非阻塞赋值确保时序正确性
- 测试台提供了全面的功能验证
- 代码结构清晰，便于维护和扩展